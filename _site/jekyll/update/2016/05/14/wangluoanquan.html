<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>[课程讲稿]从破译者的角度浅析网络安全</title>
  <meta name="description" content="从破译者的角度浅析网络安全">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://yourdomain.com/jekyll/update/2016/05/14/wangluoanquan.html">
  <link rel="alternate" type="application/rss+xml" title="张云浩的个人站点" href="http://yourdomain.com/feed.xml">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">张云浩的个人站点</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">关于作者</a>
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">[课程讲稿]从破译者的角度浅析网络安全</h1>
    <p class="post-meta"><time datetime="2016-05-14T17:38:43+08:00" itemprop="datePublished">May 14, 2016</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <h1 id="section">从破译者的角度浅析网络安全</h1>

<blockquote>
  <p>实验前言：</p>
</blockquote>

<ul>
  <li>本实验本意是希望大家对网络安全提起足够的重视，请不要恶意使用本实验内容随意盗窃他人账号，如果发生后果，本人概不承担责任！</li>
  <li>本文作为 陈昕 老师课程 计算机网络 的实验讲解文稿</li>
</ul>

<h2 id="section-1">实验内容一：简单的破解校园网关</h2>

<blockquote>
  <p><strong>本实验模拟了破译者使用最简单的方法（暴力破解）破解网关的过程。</strong></p>

  <p><strong>今天我尝试使用最简单的方式，来演示如何简单破解我校网关账户</strong></p>
</blockquote>

<blockquote>
  <p><strong><u>第一步，分析用何种方式破解</u></strong></p>
</blockquote>

<ul>
  <li>最简单的方式：暴力穷举</li>
  <li>稍微复杂的方式：获取数据库或者网站的管理员权限</li>
  <li>比较复杂的方式：使用漏洞破解数据库</li>
  <li>更复杂的方式：暂时不介绍</li>
</ul>

<blockquote>
  <p><strong>工具清单：</strong></p>
</blockquote>

<ul>
  <li>计算机环境：python2.7,Mac os 10.11</li>
  <li>抓包工具：Chrome for mac</li>
  <li>解释器：Pycharm for mac  （可更换为官方IDE）</li>
  <li>网络环境：校园内网</li>
</ul>

<blockquote>
  <p><u>**第二步，寻找可以验证尝试密码，即可以登录网关的网站(此处有多种选择)**</u></p>
</blockquote>

<ul>
  <li>网络邮局，URL：http://202.205.80.154</li>
  <li>用chrome打开以上URL，尝试抓包，观察数据：</li>
</ul>

<ol>
  <li>写入尝试密码，网关账号填入test_userid ,网关密码填入test_password</li>
  <li>打开开发者工具，并点击NetWork</li>
  <li>点击页面上的“连接”按钮，将我们填写的表单发送</li>
  <li>可以看到NetWork监测到了一些网络请求，打开其中第一个“202.205.80.10”</li>
  <li>点开右边Headers的标签，可以看到这一次网络请求的头部，拖到最下面’form data’，可以发现我们给服务器发送了以下内容：</li>
</ol>

<ul>
  <li>DDDDD : test_userid</li>
  <li>upass : test_password</li>
  <li>0MKKey : login</li>
</ul>

<p>（多么任性的变量名……）</p>

<p>6.至此，我们可以确定是这一次Post行为，使得服务器检验了我们的账户和密码来达到登录的效果，但是还不确定，不妨让我们来试一下</p>

<blockquote>
  <p><strong><u>第三步，尝试登录</u></strong></p>
</blockquote>

<ol>
  <li>让我们用抓包获得的信息，模拟浏览器进行一次请求吧</li>
</ol>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c">#-*- coding:utf-8 -*-</span>
<span class="c">#Author:张云浩 2016.4.29</span>
<span class="kn">import</span> <span class="nn">urllib</span>
<span class="kn">import</span> <span class="nn">urllib2</span>
<span class="k">def</span> <span class="nf">login_gateway</span><span class="p">(</span><span class="n">userid</span><span class="p">,</span><span class="n">password</span><span class="p">):</span>
    <span class="c"># 构造我们post给服务器的数据,这是服务器验证我们身份的依据,以及通过这个判断我们的行为'login'</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
		        <span class="s">"DDDDD"</span><span class="p">:</span><span class="n">userid</span><span class="p">,</span>
		        <span class="s">"upass"</span><span class="p">:</span><span class="n">password</span><span class="p">,</span>
		        <span class="s">"0MKKey"</span><span class="p">:</span><span class="s">"login"</span>
		<span class="p">}</span>
    <span class="c"># 构造头文件,实际使用中是不需要的,可能是网站为了兼容性牺牲,也可能纯粹为了偷懒......</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">'Host'</span><span class="p">:</span><span class="s">'202.205.80.10'</span><span class="p">,</span>
		<span class="s">'Origin'</span><span class="p">:</span><span class="s">'http://202.205.80.154'</span><span class="p">,</span>
		<span class="s">'Referer'</span><span class="p">:</span><span class="s">'http://202.205.80.154/'</span><span class="p">,</span>
		<span class="s">'User-Agent'</span><span class="p">:</span><span class="s">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_3)'</span>
                     <span class="s">' AppleWebKit/537.36 (KHTML, like Gecko) '</span>
                     <span class="s">'Chrome/49.0.2623.87 Safari/537.36'</span>
		<span class="p">}</span>

    <span class="c"># 将我们post的数据进行合理的编码,使得网站可以辨认</span>
    <span class="n">post_data</span><span class="o">=</span><span class="n">urllib</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="c"># 从抓包分析到的服务器处理请求的url</span>
    <span class="n">login_url</span> <span class="o">=</span> <span class="s">'http://202.205.80.10/'</span>
    <span class="c"># 构建一个请求对象,包含上面定义的数据,头文件,服务器地址</span>
    <span class="n">request</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">login_url</span><span class="p">,</span><span class="n">post_data</span><span class="p">,</span><span class="n">headers</span><span class="p">)</span>
    <span class="c"># 发送我们的请求给服务器,并将返回的数据作为一个对象保存在response中</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="c"># 返回服务器回应的内容</span>
    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="c"># 向服务器发送登录请求</span>
<span class="k">print</span> <span class="n">login_gateway</span><span class="p">(</span><span class="s">'test'</span><span class="p">,</span><span class="s">'test'</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'gb2312'</span><span class="p">)</span>
</code></pre>
</div>

<ul>
  <li>
    <p>以上的代码可以向服务器发送一个request请求并返回服务器返回的内容，这个内容可以作为我们检验密码是否正确的依据（有兴趣的同学可以将以上代码中最下方两个’test’替换成正确的密码，即可实现网关的登录）</p>

    <ul>
      <li>显然，这样是无法返回正确的内容的(因为我并没有传递给服务器正确的账户密码)，服务器回应的是一个对应错误登录的内容。我们可以将自己正确的网关账号输入上去，可以看到对应正确登录的内容。</li>
      <li>快速验证返回内容是否正确的诀窍是：找出正确或者错误回应中，唯一的内容（即另一种回应全文无法找到该信息）</li>
    </ul>

    <p><strong>Tips : 最近由于校园网频频改版，以上代码可能无法使用，但原理是不变的。</strong></p>
  </li>
</ul>

<blockquote>
  <p><strong><u>第四步，尝试暴力破解</u></strong></p>
</blockquote>

<ul>
  <li>
    <p>最简单的方式：使用弱密码遍历，如6个重复数字，顺序数字等（耗时忽略不计）</p>
  </li>
  <li>简单的方式：使用for循环，实现简单的任意遍历（每百次约耗时14.85秒，若实现遍历所有6位数字，大约需要42小时）</li>
  <li>更接近暴力破解的方式：使用python自带的多线程遍历，使用简单的新建线程即可（6位数字全部遍历，大约需要0-30分钟）</li>
  <li>更聪明的方式：安全风险较大，仅口头介绍</li>
</ul>

<blockquote>
  <p><strong>让我们梳理一下上面理论上的知识点</strong></p>
</blockquote>

<ul>
  <li>常用HTTP协议的请求报文—通常是用户向服务器发送的获取某一页面内容的请求
    <ul>
      <li>GET方式：请求读取由URL所标识的信息</li>
      <li>POST方式：给服务器添加信息</li>
    </ul>
  </li>
  <li>用户访问一个网站的过程解析：
    <ul>
      <li>第一步，用户使用浏览器分析指向的URL（统一资源定位符，可以简单的理解为浏览器显示的网站地址）</li>
      <li>第二步, 浏览器向DNS服务器申请域名解析，获取网站IP地址</li>
      <li>第三步，浏览器获得从DNS返回的IP地址</li>
      <li>第四步，浏览器请求与服务器建立TCP连接（默认端口一般为80）</li>
      <li>第五步，浏览器向服务器发出HTTP请求（如上面的POST方式或GET方式）</li>
      <li>第六步，服务器返回响应给浏览器，这一般是页面的内容或相应的文件</li>
      <li>第七步，TCP连接中断</li>
      <li>第八步，浏览器解析返回的信息（一般由html,css,JavaScript等组成）</li>
    </ul>
  </li>
  <li>
    <p>暴力破解的为什么有速度限制？</p>

    <p>​答：因为每一次验证密码，都要对服务器进行一次‘用户请求’-&gt;服务器接收’-&gt;’服务器验证’-&gt;‘服务器返回信息’-&gt;’用户接收回应’的过程，限制因素非常多，甚至有时出现服务器不响应的情况，需要额外的代码去处理这些错误。</p>
  </li>
</ul>

<h2 id="wifi">实验内容二：使用伪装WIFI，抓包截取用户密码</h2>

<blockquote>
  <p><strong>本实验模拟了免费WIF如何盗取用户密码的过程。</strong></p>

  <p><strong>例如，在一个公共场合，建立一个伪装成免费WIFI的无线网络（比如可设置为cau-free-wifi），诱惑用户连接WIFI,在用户连上了以后，用户访问的所有网络数据都可以被截获，极易造成账户密码的泄露。</strong></p>
</blockquote>

<blockquote>
  <p><strong>工具清单：</strong></p>
</blockquote>

<ul>
  <li>抓包工具: WireShark for mac 2.0.3</li>
  <li>WIFI共享工具： mac os 自带</li>
  <li>系统环境： mac os 10.11</li>
  <li>网络环境：自建wifi或以校园内网为基础的wifi</li>
</ul>

<blockquote>
  <p><strong><u>第一步，创建伪装网络wifi</u></strong></p>
</blockquote>

<ul>
  <li>网络来源：校园wifi或已连接上网络的wifi</li>
  <li>网络伪装ssid：CAU或CAUNET或XXX免费WIFI 等</li>
  <li>网络共享，开启ssid广播</li>
</ul>

<blockquote>
  <p><strong><u>第二步：使用抓包软件，截获用户的数据包</u></strong></p>
</blockquote>

<ul>
  <li>
    <p>选取抓包端口:wifi的对应端口</p>
  </li>
  <li>创建过滤器：是查看http协议中向服务器用post（或get）方式发送的数据</li>
  <li>查看包含明文的数据：从From data处可获得所有post的数据</li>
  <li>查看截获的加密数据：如果有简单的Md5加密或base64编码，可破解（如今安全性高的网站或应用已经不能直接看到明文）</li>
</ul>

<p><strong>现在我们知道，为什么不能连接免费的wifi了吧？因为我们访问所有链接的过程全都被抓包工具记录下来，很容易造成密码的泄露。</strong></p>

<blockquote>
  <p><strong>让我们梳理一下上面理论上的知识点</strong></p>
</blockquote>

<ul>
  <li>抓包的基本原理：</li>
</ul>

<ol>
  <li>
    <p>我们抓到的包是什么？</p>

    <p>答：包(Packet)：在包交换网络里，单个消息被划分为多个数据块，这些数据块称为包，它包含发送者和接收者的地址信息。这些包然后沿着不同的路径在一个或多个网络中传输，并且在目的地重新组合。</p>

    <p>​	数据包主要由“目的IP地址”、“源IP地址”、“净载数据”等部分构成，包括包头和包体，包头是固定长度，包体的长度不定，各字段长度固定，双方的请求数据包和应答数据包的包头结构是一致的，不同的是包体的定义。 数据包的结构与我们平常写信非常类似，目的IP地址是说明这个数据包是要发给谁的，相当于收信人地址；源IP地址是说明这个数据包是发自哪里的，相当于发信人地址；而净载数据相当于信件的内容。 正是因为数据包具有这样的结构，安装了TCP/IP协议的计算机之间才能相互通信。我们在使用基于TCP/IP协议的网络时，网络中其实传递的就是数据包。</p>
  </li>
  <li>
    <p>我们为什么能够抓到包？</p>

    <p>答：在一般情况下，网络上所有的机器都可以“听”到通过的流量，但对不属于自己的数据包则不予响应（换句话说，工作站A不会捕获属于工作站B的数据，而是简单地忽略这些数据）。如果某个工作站的网络接口处于混杂模式，那么它就可以捕获网络上所有的数据包和帧。</p>
  </li>
  <li>
    <p>为什么别人能从包里面截取我们的信息？</p>

    <p>答：因为一般安全性不高的应用和网站（诸如微博，论坛，网关）没有对POST数据进行加密（或者用简单方式加密，如BASE64,MD5），致使数据在数据包中以明文显示，所以能轻易看到这些信息。（编者注：BASE64其实是一种编码方式，不涉及加密）</p>

    <p>​        即便劫持者没有能力破解账户密码，也可以了解你访问的网站，用户名，浏览历史。这对进一步使用木马或者其他方式破解带来了很多可能。</p>
  </li>
</ol>

<h2 id="section-2">后续</h2>

<blockquote>
  <p><strong>安全密码的建议</strong></p>
</blockquote>

<ul>
  <li>
    <p>请大家不要使用 弱密码，纯数字密码</p>
  </li>
  <li>
    <p>密码中尽量不要包含个人信息，包括名字，生日，学校</p>
  </li>
  <li>
    <p>比较安全的密码（举例）：每个网站登录密码相互独立，并且使用随机数生成（伪随机数对于一般用户足矣）</p>

    <p>​</p>
  </li>
</ul>

<blockquote>
  <p><strong>更多的信息</strong></p>
</blockquote>

<ul>
  <li>
    <p>这部分尝试登录内容，仅仅是我编写的【农大网关自动登录】脚本的一小部分内容，想要尝试一下我编写的脚本，可以访问-爱思资源站的分享（已经完成打包测试，使用非常简单，让我们登录网关的过程没有丝毫拖泥带水）：http://is.cau.edu.cn/forum.php?mod=viewthread&amp;tid=201963</p>
  </li>
  <li>
    <p>另外关于本校可用脚本还有【Urp绩点计算系统】和【农大网关流量监测系统】，在爱思PT上都有相应的分享:http://is.cau.edu.cn/forum.php?mod=viewthread&amp;tid=201547</p>
  </li>
  <li>
    <p>想要了解以上项目的最新的改进，可以访问我的GitHub关注这些项目的最新进展:https://github.com/ZYunH</p>

    <p>​</p>
  </li>
</ul>


  </div>

</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">张云浩的个人站点</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>张云浩的个人站点</li>
          <li><a href="mailto:workvl@163.com">workvl@163.com</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/ZYunH"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">ZYunH</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/None!"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">None!</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>这是我的个人网站，主要分享一些有有意思的文章。
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
